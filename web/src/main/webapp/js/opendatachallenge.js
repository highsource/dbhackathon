moment.locale('de', {});

angular.module('dbhackathon', ['autocomplete', 'ngAnimate', 'ui.bootstrap.datetimepicker']).controller('dbhackathonCtrl', ['$scope','$http', function($scope, $http) {
	console.log('ready');
	$scope.live = true;
	
	$scope.suggestLocations = $scope.live?'http://localhost:8080/dbodtc-web/suggestLocations?text=':'result.json?';
	$scope.queryTrips = function(vonId, nachId){
		return $scope.live?'http://localhost:8080//dbodtc-web/queryTrips?fromId='+vonId+'&toId='+nachId+'&timestamp='+Math.round(new Date($scope.startTrip).getTime()):'result.json?';
	}
	$scope.vonList = [];
	$scope.vonMap = {};
	$scope.nachList = [];
	$scope.nachMap = {};
	$scope.trips = [];
	$scope.absZero = 273.15;
	$scope.startTrip = new Date();
	
	$scope.weatherMap = {
		day:{
			951: {icon:"wi-day-sunny", description:"ruhig", empfehlung: ""},
			952: {icon:"wi-day-sunny", description:"leichte Briese", empfehlung: ""},
			953: {icon:"wi-day-sunny", description:"leichte Briese", empfehlung: ""},
			954: {icon:"wi-day-cloudy-windy", description:"windig", empfehlung: ""},
			955: {icon:"wi-day-cloudy-windy", description:"windig", empfehlung: ""},
			956: {icon:"wi-day-cloudy-windy", description:"windig", empfehlung: ""},
			957: {icon:"wi-day-cloudy-gusts", description:"starker Wind", empfehlung: ""},
			958: {icon:"wi-day-cloudy-gusts", description:"starker Wind", empfehlung: ""},
			959: {icon:"wi-day-cloudy-gusts", description:"starke Böen", empfehlung: ""},
			960: {icon:"wi-day-storm-showers", description:"sehr starke Böen", empfehlung: ""},
			961: {icon:"wi-day-thunderstorm", description:"Gewitter", empfehlung: ""},
			962: {icon:"wi-day-thunderstorm", description:"Gewitter", empfehlung: ""},
			800: {icon:"wi-day-sunny", description:"klarer Himmel", empfehlung: ""},
			801: {icon:"wi-day-cloudy", description:"leicht bewölkt", empfehlung: ""},
			802: {icon:"wi-cloudy", description:"leicht bewölkt", empfehlung: ""},
			803: {icon:"wi-cloudy", description:"bewölkt", empfehlung: ""},
			804: {icon:"wi-fog", description:"bedekt", empfehlung: ""},
			500: {icon:"wi-day-rain-mix", description:"leichter Regen", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			501: {icon:"wi-day-showers", description:"Regen", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			502: {icon:"wi-day-rain", description:"starker Regen", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			503: {icon:"wi-day-rain", description:"sehr starker Regen", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			504: {icon:"wi-day-rain", description:"sehr starker Niederschlag", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			511: {icon:"wi-day-hail", description:"gefrierender Regen", empfehlung: "Und Achtung, es kann glatt werden."},
			520: {icon:"wi-day-showers", description:"leichte Schauer", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			521: {icon:"wi-day-showers", description:"Schauer", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			522: {icon:"wi-day-showers", description:"starker Schauer", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			531: {icon:"wi-day-showers", description:"starker Schauer", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."}
		},
		night:{
			951: {icon:"wi-night-clear", description:"ruhig", empfehlung: ""},
			952: {icon:"wi-night-clear", description:"leichte Briese", empfehlung: ""},
			953: {icon:"wi-night-alt-cloudy-windy", description:"leichte Briese", empfehlung: ""},
			954: {icon:"wi-night-alt-cloudy-gusts", description:"windig", empfehlung: ""},
			955: {icon:"wi-night-alt-cloudy-gusts", description:"windig", empfehlung: ""},
			956: {icon:"wi-night-alt-cloudy-gusts", description:"windig", empfehlung: ""},
			957: {icon:"wi-night-alt-cloudy-gusts", description:"starker Wind", empfehlung: ""},
			958: {icon:"wi-night-alt-cloudy-gusts", description:"starker Wind", empfehlung: ""},
			959: {icon:"wi-night-alt-cloudy-gusts", description:"starke Böen", empfehlung: ""},
			960: {icon:"wi-night-alt-storm-showers", description:"sehr starke Böen", empfehlung: ""},
			961: {icon:"wi-night-alt-thunderstorm", description:"Gewitter", empfehlung: ""},
			962: {icon:"wi-night-alt-thunderstorm", description:"Gewitter", empfehlung: ""},
			800: {icon:"wi-night-cloudy", description:"klarer Himmel", empfehlung: ""},
			801: {icon:"wi-night-cloudy", description:"leicht bewölkt", empfehlung: ""},
			802: {icon:"wi-cloudy", description:"leicht bewölkt", empfehlung: ""},
			803: {icon:"wi-cloudy", description:"bewölkt", empfehlung: ""},
			804: {icon:"wi-fog", description:"bedekt", empfehlung: ""},
			500: {icon:"wi-night-alt-rain-mix", description:"leichter Regen", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			501: {icon:"wi-night-alt-showers", description:"Regen", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			502: {icon:"wi-night-alt-rain", description:"starker Regen", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			503: {icon:"wi-night-alt-rain", description:"sehr starker Regen", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			504: {icon:"wi-night-alt-rain", description:"sehr starker Regen", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			511: {icon:"wi-night-alt-hail", description:"gefrierender Regen", empfehlung: "Und Achtung, es kann glatt werden."},
			520: {icon:"wi-night-alt-showers", description:"leichte Schauer", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			521: {icon:"wi-night-alt-showers", description:"Schauer", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			522: {icon:"wi-night-alt-showers", description:"starker Schauer", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."},
			531: {icon:"wi-night-alt-showers", description:"starker Schauer", empfehlung: "Und vergessen Sie nicht einen Regenschirm einzupacken."}
		}
	}
	
	
	$scope.loadingTrips = false;
	
	$scope.checkVon = function (typed) {
		if (typed.length>2){
			$http.get($scope.suggestLocations+typed).success(function(result){
				if (!$scope.live)
					result = {"header":{"network":"DB","serverProduct":"hafas","serverVersion":null,"serverTime":0,"context":null},"status":"OK","locations":[{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},{"type":"STATION","id":"8096009","lat":53557110,"lon":9997434,"place":null,"name":"HAMBURG","identified":true},{"type":"STATION","id":"8002548","lat":53560751,"lon":9989568,"place":null,"name":"Hamburg Dammtor","identified":true},{"type":"STATION","id":"8002553","lat":53552696,"lon":9935174,"place":null,"name":"Hamburg-Altona","identified":true},{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},{"type":"STATION","id":"8000149","lat":51678077,"lon":7807823,"place":null,"name":"Hamm(Westf)","identified":true},{"type":"STATION","id":"8002554","lat":53489835,"lon":10206172,"place":null,"name":"Hamburg-Bergedorf","identified":true},{"type":"STATION","id":"8002555","lat":53595889,"lon":9907101,"place":null,"name":"Hamburg-Eidelstedt","identified":true},{"type":"STATION","id":"8002628","lat":53564715,"lon":10056124,"place":null,"name":"Hamburg Hasselbrook","identified":true},{"type":"STATION","id":"8800494","lat":50319924,"lon":4404894,"place":null,"name":"Ham-sur-Heure","identified":true},{"type":"STATION","id":"8007046","lat":53647613,"lon":9908494,"place":null,"name":"Hamburg Burgwedel","identified":true},{"type":"STATION","id":"8007044","lat":53610371,"lon":9901519,"place":null,"name":"Hamburg-Eidelstedt Zentrum","identified":true},{"type":"STATION","id":"8002909","lat":53617284,"lon":9903622,"place":null,"name":"Hamburg-Hörgensweg","identified":true},{"type":"STATION","id":"8002558","lat":53604861,"lon":10154394,"place":null,"name":"Hamburg-Rahlstedt","identified":true},{"type":"STATION","id":"8007045","lat":53634121,"lon":9906616,"place":null,"name":"Hamburg-Schnelsen","identified":true},{"type":"STATION","id":"8006197","lat":53586388,"lon":10123049,"place":null,"name":"Hamburg-Tonndorf","identified":true},{"type":"STATION","id":"8002560","lat":53569974,"lon":10077222,"place":null,"name":"Hamburg-Wandsbek","identified":true},{"type":"STATION","id":"8002565","lat":53612142,"lon":9368728,"place":null,"name":"Hammah","identified":true},{"type":"STATION","id":"8011815","lat":53070227,"lon":13435745,"place":null,"name":"Hammelspring","identified":true},{"type":"STATION","id":"8003943","lat":51738961,"lon":6518249,"place":null,"name":"Hamminkeln-Mehrhoog","identified":true},{"type":"STATION","id":"8002547","lat":53632350,"lon":10006648,"place":null,"name":"Hamburg Airport","identified":true},{"type":"STATION","id":"8000512","lat":53597930,"lon":10035413,"place":null,"name":"Hamburg Alte Wöhr","identified":true},{"type":"STATION","id":"8000805","lat":53587458,"lon":10044160,"place":null,"name":"Hamburg-Barmbek","identified":true},{"type":"STATION","id":"8001438","lat":53568571,"lon":9934257,"place":null,"name":"Hamburg Diebsteich","identified":true},{"type":"STATION","id":"8001739","lat":53602577,"lon":9893734,"place":null,"name":"Hamburg Elbgaustraße","identified":true},{"type":"STATION","id":"8002106","lat":53576329,"lon":10057437,"place":null,"name":"Hamburg Friedrichsberg","identified":true},{"type":"STATION","id":"8002946","lat":53635478,"lon":10067648,"place":null,"name":"Hamburg Hoheneichen","identified":true},{"type":"STATION","id":"8002550","lat":53561757,"lon":9949737,"place":null,"name":"Hamburg Holstenstraße","identified":true},{"type":"STATION","id":"8003410","lat":53632377,"lon":10053841,"place":null,"name":"Hamburg Kornweg(Klein Borstel)","identified":true},{"type":"STATION","id":"8003460","lat":53615819,"lon":9867764,"place":null,"name":"Hamburg-Krupunder","identified":true},{"type":"STATION","id":"8003541","lat":53579691,"lon":9930922,"place":null,"name":"Hamburg-Langenfelde","identified":true},{"type":"STATION","id":"8004661","lat":53620870,"lon":10031970,"place":null,"name":"Hamburg-Ohlsdorf","identified":true},{"type":"STATION","id":"8004862","lat":53652180,"lon":10094032,"place":null,"name":"Hamburg-Poppenbüttel","identified":true},{"type":"STATION","id":"8005207","lat":53605966,"lon":10033085,"place":null,"name":"Hamburg Rübenkamp","identified":true},{"type":"STATION","id":"8002559","lat":53589840,"lon":9918337,"place":null,"name":"Hamburg-Stellingen","identified":true},{"type":"STATION","id":"8070146","lat":53563717,"lon":9967203,"place":null,"name":"Hamburg-Sternschanze","identified":true},{"type":"STATION","id":"8006198","lat":53569731,"lon":10059972,"place":null,"name":"Hamburg Wandsbeker Chaussee","identified":true},{"type":"STATION","id":"8006319","lat":53641330,"lon":10082822,"place":null,"name":"Hamburg-Wellingsbüttel","identified":true},{"type":"STATION","id":"8000148","lat":52101846,"lon":9375901,"place":null,"name":"Hameln","identified":true},{"type":"STATION","id":"8003518","lat":53546134,"lon":9971284,"place":null,"name":"Hamburg Landungsbrücken","identified":true},{"type":"STATION","id":"8000779","lat":53490356,"lon":10158736,"place":null,"name":"Hamburg-Allermöhe","identified":true},{"type":"STATION","id":"8000780","lat":53560058,"lon":9910778,"place":null,"name":"Hamburg-Bahrenfeld","identified":true},{"type":"STATION","id":"8000908","lat":53552867,"lon":10024626,"place":null,"name":"Hamburg Berliner Tor","identified":true},{"type":"STATION","id":"8000971","lat":53515589,"lon":10096657,"place":null,"name":"Hamburg Billwerder-Moorfleet","identified":true},{"type":"STATION","id":"8001007","lat":53564364,"lon":9814611,"place":null,"name":"Hamburg-Blankenese","identified":true},{"type":"STATION","id":"8002556","lat":53474733,"lon":9819564,"place":null,"name":"Hamburg-Fischbek","identified":true},{"type":"STATION","id":"8004266","lat":53546611,"lon":10023610,"place":null,"name":"Hamburg-Hammerbrook","identified":true},{"type":"STATION","id":"8004267","lat":53460692,"lon":9980462,"place":null,"name":"Hamburg-Harburg Rathaus","identified":true},{"type":"STATION","id":"8006749","lat":53465483,"lon":9963185,"place":null,"name":"Hamburg-Heimfeld","identified":true},{"type":"STATION","id":"8002873","lat":53561371,"lon":9842073,"place":null,"name":"Hamburg Hochkamp","identified":true}]};
				var stations = [];
				$scope.vonMap = {};
				result.locations.forEach(function(station, n){
					stations.push(station.name);
					$scope.vonMap[station.name] = station;
				});
				if (stations.length>10){
					stations=stations.slice(0,10);
				}
				$scope.vonList = stations;
			});
		} else {
			$scope.vonList = [];
		}
	};
	
	$scope.checkNach = function (typed) {
		if (typed.length>2){
			$http.get($scope.suggestLocations+typed).success(function(result){
				if (!$scope.live)
					result = {"header":{"network":"DB","serverProduct":"hafas","serverVersion":null,"serverTime":0,"context":null},"status":"OK","locations":[{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},{"type":"STATION","id":"8000051","lat":53534916,"lon":8599557,"place":null,"name":"Bremerhaven Hbf","identified":true},{"type":"STATION","id":"8001160","lat":53039763,"lon":8944626,"place":null,"name":"Bremen-Mahndorf","identified":true},{"type":"STATION","id":"8001155","lat":53075783,"lon":8785805,"place":null,"name":"Bremen Neustadt","identified":true},{"type":"STATION","id":"8001168","lat":53566324,"lon":8600654,"place":null,"name":"Bremerhaven-Lehe","identified":true},{"type":"STATION","id":"8004364","lat":50359602,"lon":8159859,"place":null,"name":"Brechen-Niederbrech.","identified":true},{"type":"STATION","id":"8004518","lat":50354496,"lon":8187797,"place":null,"name":"Brechen-Oberbrechen","identified":true},{"type":"STATION","id":"8011258","lat":52886047,"lon":12224214,"place":null,"name":"Breddin","identified":true},{"type":"STATION","id":"8001136","lat":54314937,"lon":9867890,"place":null,"name":"Bredenbek","identified":true},{"type":"STATION","id":"8001139","lat":54620947,"lon":8970416,"place":null,"name":"Bredstedt","identified":true},{"type":"STATION","id":"8011260","lat":51554457,"lon":12222165,"place":null,"name":"Brehna","identified":true},{"type":"STATION","id":"8000694","lat":50504220,"lon":7304562,"place":null,"name":"Breisig Bad","identified":true},{"type":"STATION","id":"8011263","lat":50476947,"lon":12745885,"place":null,"name":"Breitenbrunn(Erzg)","identified":true},{"type":"STATION","id":"8011264","lat":51138841,"lon":14622087,"place":null,"name":"Breitendorf","identified":true},{"type":"STATION","id":"8001149","lat":49966827,"lon":10887132,"place":null,"name":"Breitengüßbach","identified":true},{"type":"STATION","id":"8001153","lat":50748430,"lon":7661488,"place":"Ww)","name":"Breitscheidt(Altenkirchen","identified":true},{"type":"STATION","id":"8011265","lat":50752889,"lon":10322268,"place":null,"name":"Breitungen(Werra)","identified":true},{"type":"STATION","id":"8001161","lat":53087037,"lon":8938513,"place":null,"name":"Bremen-Oberneuland","identified":true},{"type":"STATION","id":"8001156","lat":53160290,"lon":8704776,"place":null,"name":"Bremen-Burg","identified":true},{"type":"STATION","id":"8007892","lat":53185226,"lon":8617338,"place":null,"name":"Bremen-Aumund","identified":true},{"type":"STATION","id":"8007894","lat":53183635,"lon":8581183,"place":null,"name":"Bremen-Blumenthal","identified":true},{"type":"STATION","id":"8007898","lat":53205200,"lon":8516605,"place":null,"name":"Bremen-Farge","identified":true},{"type":"STATION","id":"8007896","lat":53188786,"lon":8557847,"place":null,"name":"Bremen Kreinsloger","identified":true},{"type":"STATION","id":"8007895","lat":53185208,"lon":8571340,"place":null,"name":"Bremen Mühlenstraße","identified":true},{"type":"STATION","id":"8007897","lat":53193236,"lon":8545406,"place":null,"name":"Bremen Turnerstraße","identified":true},{"type":"STATION","id":"8001166","lat":53169720,"lon":8629968,"place":null,"name":"Bremen-Vegesack","identified":true},{"type":"STATION","id":"8001143","lat":48026919,"lon":7589349,"place":null,"name":"Breisach","identified":true},{"type":"STATION","id":"8070176","lat":53502932,"lon":8571906,"place":null,"name":"Bremerhaven Flugplatz","identified":true},{"type":"STATION","id":"8001159","lat":53170718,"lon":8686150,"place":null,"name":"Bremen-Lesum","identified":true},{"type":"STATION","id":"8001162","lat":53135300,"lon":8740805,"place":null,"name":"Bremen-Oslebshausen","identified":true},{"type":"STATION","id":"8001163","lat":53172803,"lon":8649483,"place":null,"name":"Bremen-Schönebeck","identified":true},{"type":"STATION","id":"8001165","lat":53171581,"lon":8669736,"place":null,"name":"Bremen-St Magnus","identified":true},{"type":"STATION","id":"8001167","lat":53103793,"lon":8786236,"place":null,"name":"Bremen-Walle","identified":true},{"type":"STATION","id":"8001170","lat":53508595,"lon":8611935,"place":null,"name":"Bremerhaven-Wulsdorf","identified":true},{"type":"STATION","id":"8001164","lat":53061355,"lon":8887383,"place":null,"name":"Bremen-Sebaldsbrück","identified":true},{"type":"STATION","id":"8007800","lat":53482958,"lon":9140249,"place":null,"name":"Bremervörde","identified":true},{"type":"STATION","id":"8001137","lat":51419169,"lon":8776564,"place":null,"name":"Bredelar","identified":true},{"type":"STATION","id":"8001147","lat":48138583,"lon":10408501,"place":null,"name":"Breitenbrunn(Schwab)","identified":true},{"type":"STATION","id":"8001148","lat":49691380,"lon":9225053,"place":null,"name":"Breitendiel","identified":true},{"type":"STATION","id":"8505378","lat":46010845,"lon":8984772,"place":null,"name":"Bre Villaggio","identified":true},{"type":"STATION","id":"8001135","lat":49215859,"lon":7029177,"place":null,"name":"Brebach","identified":true},{"type":"STATION","id":"8001157","lat":53054568,"lon":8886762,"place":null,"name":"Bremen-Hemelingen","identified":true},{"type":"STATION","id":"8071651","lat":50432442,"lon":7168888,"place":null,"name":"Brenk","identified":true},{"type":"STATION","id":"775884","lat":53052905,"lon":8786245,"place":null,"name":"BRE Bremen Airport","identified":true},{"type":"STATION","id":"8075948","lat":50512257,"lon":7299807,"place":null,"name":"Breisig SF Bad","identified":true},{"type":"STATION","id":"8070030","lat":53544210,"lon":8568985,"place":null,"name":"Bremerhaven Seebäderkaje","identified":true},{"type":"STATION","id":"8591587","lat":46010405,"lon":8996089,"place":"Paese","name":"Bre","identified":true},{"type":"STATION","id":"8591588","lat":46007412,"lon":8989779,"place":"S. Antonio","name":"Bre","identified":true},{"type":"STATION","id":"8100090","lat":47503001,"lon":9739623,"place":null,"name":"Bregenz","identified":true},{"type":"STATION","id":"8600330","lat":55666671,"lon":9659187,"place":null,"name":"Brejning st","identified":true}]};
				var stations = [];
				$scope.nachMap = {};
				result.locations.forEach(function(station, n){
					stations.push(station.name);
					$scope.nachMap[station.name] = station;
				});
				if (stations.length>10){
					stations=stations.slice(0,10);
				}
				$scope.nachList = stations;
			});
		} else {
			$scope.nachList = [];
		}
	};
	
	$scope.fetchWeather = function(theArray, index) {
		function transform(z) {
			return (z/1000000).toString().replace(/,/g, '.');
		}
		
		$http.get('http://api.openweathermap.org/data/2.5/forecast?lat='+transform(theArray[index].from.lat)+'&lon='+transform(theArray[index].from.lon)).success(function(result){
			theArray[index].from.weather=result;
		});
		$http.get('http://api.openweathermap.org/data/2.5/forecast?lat='+transform(theArray[index].to.lat)+'&lon='+transform(theArray[index].to.lon)).success(function(result){
			theArray[index].to.weather=result;
		});
		
	};
	
	$scope.suche = function(){
		if ($scope.von.length>0&&$scope.nach.length>0){
			$scope.loadingTrips = true;
			$http.get($scope.queryTrips($scope.vonMap[$scope.von].id,$scope.nachMap[$scope.nach].id)).success(function(result){
				if (!$scope.live)
					result = {"header":{"network":"DB","serverProduct":"hafas","serverVersion":"6","serverTime":0,"context":null},"status":"OK","ambiguousFrom":null,"ambiguousVia":null,"ambiguousTo":null,"queryUri":"http://reiseauskunft.bahn.de/bin/query.exe/dn?start=Suchen&REQ0JourneyStopsS0ID=A%3D1%40L%3D8096009&REQ0JourneyStopsZ0ID=A%3D1%40L%3D8000050&REQ0HafasSearchForw=1&REQ0JourneyDate=21.03.15&REQ0JourneyTime=01%3A31&REQ0JourneyProduct_prod_list_1=11000000000000&h2g-direct=11&clientType=ANDROID","from":{"type":"STATION","id":"8096009","lat":0,"lon":0,"place":null,"name":null,"identified":true},"via":null,"to":{"type":"STATION","id":"8000050","lat":0,"lon":0,"place":null,"name":null,"identified":true},"context":{"ident":"d7.023275243.1426897900","seqNr":1,"ld":"96243","usedBufferSize":1928},"trips":[{"id":"C0-0","from":{"type":"STATION","id":null,"lat":53557110,"lon":9997434,"place":null,"name":"HAMBURG","identified":false},"to":{"type":"STATION","id":null,"lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":false},"legs":[{"departure":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"arrival":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"path":null,"line":{"id":null,"network":null,"product":"HIGH_SPEED_TRAIN","label":"EC7","style":{"shape":"RECT","backgroundColor":-1,"foregroundColor":-65536,"borderColor":-65536},"attrs":["BICYCLE_CARRIAGE"],"message":null},"destination":null,"departureStop":{"location":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":null,"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426909320000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"13","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426909320000,"maxTime":null,"departureTime":1426909320000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"13","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":null,"arrivalPositionPredicted":false},"arrivalStop":{"location":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"plannedArrivalTime":1426912620000,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"9","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":null,"predictedDepartureTime":null,"plannedDeparturePosition":null,"predictedDeparturePosition":null,"departureCancelled":false,"minTime":null,"maxTime":1426912620000,"departureTime":null,"arrivalTime":1426912620000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":null,"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"9","section":null},"arrivalPositionPredicted":false},"intermediateStops":[{"location":{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"3","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426909980000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"3","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426909980000,"maxTime":null,"departureTime":1426909980000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"3","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"3","section":null},"arrivalPositionPredicted":false}],"message":null,"minTime":1426909320000,"maxTime":1426912620000,"departureTime":1426909320000,"arrivalTime":1426912620000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"13","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"9","section":null},"arrivalPositionPredicted":false}],"fares":null,"capacity":null,"numChanges":0,"duration":3300000,"minTime":1426909320000,"lastPublicLeg":{"departure":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"arrival":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"path":null,"line":{"id":null,"network":null,"product":"HIGH_SPEED_TRAIN","label":"EC7","style":{"shape":"RECT","backgroundColor":-1,"foregroundColor":-65536,"borderColor":-65536},"attrs":["BICYCLE_CARRIAGE"],"message":null},"destination":null,"departureStop":{"location":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":null,"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426909320000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"13","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426909320000,"maxTime":null,"departureTime":1426909320000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"13","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":null,"arrivalPositionPredicted":false},"arrivalStop":{"location":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"plannedArrivalTime":1426912620000,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"9","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":null,"predictedDepartureTime":null,"plannedDeparturePosition":null,"predictedDeparturePosition":null,"departureCancelled":false,"minTime":null,"maxTime":1426912620000,"departureTime":null,"arrivalTime":1426912620000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":null,"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"9","section":null},"arrivalPositionPredicted":false},"intermediateStops":[{"location":{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"3","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426909980000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"3","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426909980000,"maxTime":null,"departureTime":1426909980000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"3","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"3","section":null},"arrivalPositionPredicted":false}],"message":null,"minTime":1426909320000,"maxTime":1426912620000,"departureTime":1426909320000,"arrivalTime":1426912620000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"13","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"9","section":null},"arrivalPositionPredicted":false},"firstPublicLeg":{"departure":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"arrival":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"path":null,"line":{"id":null,"network":null,"product":"HIGH_SPEED_TRAIN","label":"EC7","style":{"shape":"RECT","backgroundColor":-1,"foregroundColor":-65536,"borderColor":-65536},"attrs":["BICYCLE_CARRIAGE"],"message":null},"destination":null,"departureStop":{"location":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":null,"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426909320000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"13","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426909320000,"maxTime":null,"departureTime":1426909320000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"13","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":null,"arrivalPositionPredicted":false},"arrivalStop":{"location":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"plannedArrivalTime":1426912620000,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"9","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":null,"predictedDepartureTime":null,"plannedDeparturePosition":null,"predictedDeparturePosition":null,"departureCancelled":false,"minTime":null,"maxTime":1426912620000,"departureTime":null,"arrivalTime":1426912620000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":null,"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"9","section":null},"arrivalPositionPredicted":false},"intermediateStops":[{"location":{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"3","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426909980000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"3","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426909980000,"maxTime":null,"departureTime":1426909980000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"3","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"3","section":null},"arrivalPositionPredicted":false}],"message":null,"minTime":1426909320000,"maxTime":1426912620000,"departureTime":1426909320000,"arrivalTime":1426912620000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"13","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"9","section":null},"arrivalPositionPredicted":false},"lastPublicLegArrivalTime":1426912620000,"firstDepartureTime":1426909320000,"publicDuration":3300000,"lastArrivalTime":1426912620000,"maxTime":1426912620000,"travelable":true,"firstPublicLegDepartureTime":1426909320000},{"id":"C0-1","from":{"type":"STATION","id":null,"lat":53557110,"lon":9997434,"place":null,"name":"HAMBURG","identified":false},"to":{"type":"STATION","id":null,"lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":false},"legs":[{"departure":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"arrival":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"path":null,"line":{"id":null,"network":null,"product":"HIGH_SPEED_TRAIN","label":"ICE27","style":{"shape":"RECT","backgroundColor":-1,"foregroundColor":-65536,"borderColor":-65536},"attrs":null,"message":null},"destination":null,"departureStop":{"location":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":null,"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426913160000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"14","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426913160000,"maxTime":null,"departureTime":1426913160000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":null,"arrivalPositionPredicted":false},"arrivalStop":{"location":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"plannedArrivalTime":1426916460000,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"8","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":null,"predictedDepartureTime":null,"plannedDeparturePosition":null,"predictedDeparturePosition":null,"departureCancelled":false,"minTime":null,"maxTime":1426916460000,"departureTime":null,"arrivalTime":1426916460000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":null,"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"intermediateStops":[{"location":{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"3","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426913820000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"3","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426913820000,"maxTime":null,"departureTime":1426913820000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"3","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"3","section":null},"arrivalPositionPredicted":false}],"message":null,"minTime":1426913160000,"maxTime":1426916460000,"departureTime":1426913160000,"arrivalTime":1426916460000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false}],"fares":null,"capacity":null,"numChanges":0,"duration":3300000,"minTime":1426913160000,"lastPublicLeg":{"departure":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"arrival":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"path":null,"line":{"id":null,"network":null,"product":"HIGH_SPEED_TRAIN","label":"ICE27","style":{"shape":"RECT","backgroundColor":-1,"foregroundColor":-65536,"borderColor":-65536},"attrs":null,"message":null},"destination":null,"departureStop":{"location":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":null,"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426913160000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"14","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426913160000,"maxTime":null,"departureTime":1426913160000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":null,"arrivalPositionPredicted":false},"arrivalStop":{"location":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"plannedArrivalTime":1426916460000,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"8","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":null,"predictedDepartureTime":null,"plannedDeparturePosition":null,"predictedDeparturePosition":null,"departureCancelled":false,"minTime":null,"maxTime":1426916460000,"departureTime":null,"arrivalTime":1426916460000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":null,"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"intermediateStops":[{"location":{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"3","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426913820000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"3","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426913820000,"maxTime":null,"departureTime":1426913820000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"3","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"3","section":null},"arrivalPositionPredicted":false}],"message":null,"minTime":1426913160000,"maxTime":1426916460000,"departureTime":1426913160000,"arrivalTime":1426916460000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"firstPublicLeg":{"departure":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"arrival":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"path":null,"line":{"id":null,"network":null,"product":"HIGH_SPEED_TRAIN","label":"ICE27","style":{"shape":"RECT","backgroundColor":-1,"foregroundColor":-65536,"borderColor":-65536},"attrs":null,"message":null},"destination":null,"departureStop":{"location":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":null,"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426913160000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"14","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426913160000,"maxTime":null,"departureTime":1426913160000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":null,"arrivalPositionPredicted":false},"arrivalStop":{"location":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"plannedArrivalTime":1426916460000,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"8","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":null,"predictedDepartureTime":null,"plannedDeparturePosition":null,"predictedDeparturePosition":null,"departureCancelled":false,"minTime":null,"maxTime":1426916460000,"departureTime":null,"arrivalTime":1426916460000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":null,"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"intermediateStops":[{"location":{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"3","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426913820000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"3","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426913820000,"maxTime":null,"departureTime":1426913820000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"3","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"3","section":null},"arrivalPositionPredicted":false}],"message":null,"minTime":1426913160000,"maxTime":1426916460000,"departureTime":1426913160000,"arrivalTime":1426916460000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"lastPublicLegArrivalTime":1426916460000,"firstDepartureTime":1426913160000,"publicDuration":3300000,"lastArrivalTime":1426916460000,"maxTime":1426916460000,"travelable":true,"firstPublicLegDepartureTime":1426913160000},{"id":"C0-2","from":{"type":"STATION","id":null,"lat":53557110,"lon":9997434,"place":null,"name":"HAMBURG","identified":false},"to":{"type":"STATION","id":null,"lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":false},"legs":[{"departure":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"arrival":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"path":null,"line":{"id":null,"network":null,"product":"HIGH_SPEED_TRAIN","label":"EC9","style":{"shape":"RECT","backgroundColor":-1,"foregroundColor":-65536,"borderColor":-65536},"attrs":["BICYCLE_CARRIAGE"],"message":null},"destination":null,"departureStop":{"location":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":null,"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426916760000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"14","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426916760000,"maxTime":null,"departureTime":1426916760000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":null,"arrivalPositionPredicted":false},"arrivalStop":{"location":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"plannedArrivalTime":1426920060000,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"8","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":null,"predictedDepartureTime":null,"plannedDeparturePosition":null,"predictedDeparturePosition":null,"departureCancelled":false,"minTime":null,"maxTime":1426920060000,"departureTime":null,"arrivalTime":1426920060000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":null,"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"intermediateStops":[{"location":{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"3","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426917420000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"3","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426917420000,"maxTime":null,"departureTime":1426917420000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"3","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"3","section":null},"arrivalPositionPredicted":false}],"message":null,"minTime":1426916760000,"maxTime":1426920060000,"departureTime":1426916760000,"arrivalTime":1426920060000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false}],"fares":null,"capacity":null,"numChanges":0,"duration":3300000,"minTime":1426916760000,"lastPublicLeg":{"departure":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"arrival":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"path":null,"line":{"id":null,"network":null,"product":"HIGH_SPEED_TRAIN","label":"EC9","style":{"shape":"RECT","backgroundColor":-1,"foregroundColor":-65536,"borderColor":-65536},"attrs":["BICYCLE_CARRIAGE"],"message":null},"destination":null,"departureStop":{"location":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":null,"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426916760000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"14","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426916760000,"maxTime":null,"departureTime":1426916760000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":null,"arrivalPositionPredicted":false},"arrivalStop":{"location":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"plannedArrivalTime":1426920060000,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"8","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":null,"predictedDepartureTime":null,"plannedDeparturePosition":null,"predictedDeparturePosition":null,"departureCancelled":false,"minTime":null,"maxTime":1426920060000,"departureTime":null,"arrivalTime":1426920060000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":null,"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"intermediateStops":[{"location":{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"3","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426917420000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"3","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426917420000,"maxTime":null,"departureTime":1426917420000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"3","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"3","section":null},"arrivalPositionPredicted":false}],"message":null,"minTime":1426916760000,"maxTime":1426920060000,"departureTime":1426916760000,"arrivalTime":1426920060000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"firstPublicLeg":{"departure":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"arrival":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"path":null,"line":{"id":null,"network":null,"product":"HIGH_SPEED_TRAIN","label":"EC9","style":{"shape":"RECT","backgroundColor":-1,"foregroundColor":-65536,"borderColor":-65536},"attrs":["BICYCLE_CARRIAGE"],"message":null},"destination":null,"departureStop":{"location":{"type":"STATION","id":"8002549","lat":53552732,"lon":10006908,"place":null,"name":"Hamburg Hbf","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":null,"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426916760000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"14","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426916760000,"maxTime":null,"departureTime":1426916760000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":null,"arrivalPositionPredicted":false},"arrivalStop":{"location":{"type":"STATION","id":"8000050","lat":53083477,"lon":8813833,"place":null,"name":"Bremen Hbf","identified":true},"plannedArrivalTime":1426920060000,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"8","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":null,"predictedDepartureTime":null,"plannedDeparturePosition":null,"predictedDeparturePosition":null,"departureCancelled":false,"minTime":null,"maxTime":1426920060000,"departureTime":null,"arrivalTime":1426920060000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":null,"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"intermediateStops":[{"location":{"type":"STATION","id":"8000147","lat":53455909,"lon":9991698,"place":null,"name":"Hamburg-Harburg","identified":true},"plannedArrivalTime":null,"predictedArrivalTime":null,"plannedArrivalPosition":{"name":"3","section":null},"predictedArrivalPosition":null,"arrivalCancelled":false,"plannedDepartureTime":1426917420000,"predictedDepartureTime":null,"plannedDeparturePosition":{"name":"3","section":null},"predictedDeparturePosition":null,"departureCancelled":false,"minTime":1426917420000,"maxTime":null,"departureTime":1426917420000,"arrivalTime":null,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"3","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"3","section":null},"arrivalPositionPredicted":false}],"message":null,"minTime":1426916760000,"maxTime":1426920060000,"departureTime":1426916760000,"arrivalTime":1426920060000,"departureTimePredicted":false,"departureDelay":null,"departurePosition":{"name":"14","section":null},"departurePositionPredicted":false,"arrivalTimePredicted":false,"arrivalDelay":null,"arrivalPosition":{"name":"8","section":null},"arrivalPositionPredicted":false},"lastPublicLegArrivalTime":1426920060000,"firstDepartureTime":1426916760000,"publicDuration":3300000,"lastArrivalTime":1426920060000,"maxTime":1426920060000,"travelable":true,"firstPublicLegDepartureTime":1426916760000}]};
				console.log(result);
				$scope.trips = result.trips;
				$scope.trips.forEach(function(trip, index, theArray){
					$scope.fetchWeather(theArray, index);
				});
				$scope.loadingTrips = false;
			}).error(function(){
				$scope.loadingTrips = false;
			});
		}
	};
	$scope.fill = function(c) {
		if (c<10)
			return "0"+c;
		return c;
	}

	$scope.tag = function(z) {
		var d = new Date(z);
		var tage = ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"];
		return tage[d.getDay()] + ", " + $scope.fill(d.getDate()) + "." + $scope.fill(d.getMonth()+1) + "." + $scope.fill(d.getFullYear());
	}
	
	$scope.zeit = function(z) {
		var d = new Date(z);
		return $scope.fill(d.getHours()) + ":"+ $scope.fill(d.getMinutes());
	}
	
	$scope.duration = function(z) {
		var d = new Date(z);
		function diff(count, nameSing, namePlur){
			return count>0?count + " " + (count > 1?namePlur:nameSing):"";
		}
		
		return diff( Math.floor(z/(1000*60*60*24)),"Tag", "Tage" )+ " " + diff(d.getHours(),"Stunde", "Stunden") + " " + diff(d.getMinutes(),"Minute", "Minuten") + " " + diff(d.getSeconds(),"Sekunde", "Sekunden");
	}
	
	$scope.weatherIcon = function (weather, z){
		if (typeof weather === "undefined")
			return "";
		var d = new Date(z);
		var tod = "night";
		if ((d.getHours()>=7) && (d.getHours()<=18))
			tod="day";
		
		var closest = 0;
		weather.list.forEach(function (w, n){
			if (w.dt-z<weather.list[closest].dt-z)
				closest = n;
		});
		
		var icon = $scope.weatherMap[tod][weather.list[closest].weather[0].id].icon;
		
		
		return icon?icon:"";
	}
	
	$scope.weatherDescription = function (weather, z){
		if (typeof weather === "undefined")
			return "";
		var d = new Date(z);
		var tod = "night";
		if ((d.getHours()>=7) && (d.getHours()<=18))
			tod="day";
		
		var closest = 0;
		weather.list.forEach(function (w, n){
			if (w.dt-z<weather.list[closest].dt-z)
				closest = n;
		});
		
		var description = $scope.weatherMap[tod][weather.list[closest].weather[0].id].description;
		
		
		return description?description:"";
	}
	
	$scope.weatherSupport = function (weather, z){
		if (typeof weather === "undefined")
			return "";
		var d = new Date(z);
		var tod = "night";
		if ((d.getHours()>=7) && (d.getHours()<=18))
			tod="day";
		
		var closest = 0;
		weather.list.forEach(function (w, n){
			if (w.dt-z<weather.list[closest].dt-z)
				closest = n;
		});
		
		var description = $scope.weatherMap[tod][weather.list[closest].weather[0].id].empfehlung;
		
		
		return description?description:"";
	}
	
	$scope.weatherInfo = function (weather, z){
		if (typeof weather === "undefined")
			return "";

		var closest = 0;
		weather.list.forEach(function (w, n){
			if (w.dt-z<weather.list[closest].dt-z)
				closest = n;
		});
		
		return (weather.list[closest].main.temp-$scope.absZero).toFixed(1)+" °C";
	}

	
	$scope.delayCalc = function(z) {
		return Math.round(z);
	}
	
	$scope.calcRatio = function(z) {
		return (z*100).toFixed(0);
	}
	
	$scope.parseTransfertime = function (z){
		if (z>0)
			return "Umstiegszeit: "+z+" Minuten.";
		else
			return "Keine Umstiegszeit vorhanden.";
	}

}]);